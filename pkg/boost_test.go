package boost

import (
	"context"
	"encoding/json"
	"fmt"
	"testing"

	"github.com/alecthomas/assert"
	"github.com/attestantio/go-builder-client/api/capella"
)

func TestDefaultBoost_SubmitBlock(t *testing.T) {
	type args struct {
		ctx  context.Context
		name capella.SubmitBlockRequest
	}
	tests := []struct {
		name             string
		jsonPayload      string
		txnCountExpected int64
		expectedBaseFee  uint32
		expectedErr      error
	}{
		{
			name: "lots of txns",
			jsonPayload: `{
				"message": {
					"slot": "2246842",
					"parent_hash": "0x04509e89bb0a974344d0855af9c6e41f26f3198c9edb1aac21e5c11e04745ef4",
					"block_hash": "0x2a4f3ec7cd9572a9b28aa7fb0a2c7799b90681b67f04cd64bd5e01023b81bc3b",
					"builder_pubkey": "0xaa1488eae4b06a1fff840a2b6db167afc520758dc2c8af0dfb57037954df3431b747e2f900fe8805f05d635e9a29717b",
					"proposer_pubkey": "0xa66d5b1cf24a38a598a45d16818d04e1c1331f8535591e7b9d3d13e390bfb466a0180098b4656131e087b72bf10be172",
					"proposer_fee_recipient": "0xf24a01ae29dec4629dfb4170647c4ed4efc392cd",
					"gas_limit": "30000000",
					"gas_used": "1884333",
					"value": "4429853700147000"
				},
				"execution_payload": {
					"parent_hash": "0x04509e89bb0a974344d0855af9c6e41f26f3198c9edb1aac21e5c11e04745ef4",
					"fee_recipient": "0x812fc9524961d0566b3207fee1a567fef23e5e38",
					"state_root": "0x1c70df2d36ef350d3cdacb781e0153d00c1f50d77c08ff4740b2185b741483c7",
					"receipts_root": "0xafd17a85f9de5eefa2f7e38b44a2fc560ede4dbf81433d3dbbf7da6560e49bcc",
					"logs_bloom": "0x0000020000100000000002040802000001012408000024000000000000000008000a00000004040000800000148011000008100000001000080000108020000000002008c00020000080000e600010004080100440802000000000000001000000698000060018020084200205100940000002900900000100000810000000004100040000000000000040084004800001000000003100000004000000000000020800000000000100014100400802002040000000000400000008000000400400000022200000004400000000004000200000480200000000000100000020001034000000002000002000002000000080000000080800001204000000106000",
					"prev_randao": "0xa868ab4cfafc9107183622c8d955b293558cfbaa661fd1ae41403db3f3b35618",
					"block_number": "3379258",
					"gas_limit": "30000000",
					"gas_used": "1884333",
					"timestamp": "1682695704",
					"extra_data": "0xd883010b05846765746888676f312e32302e33856c696e7578",
					"base_fee_per_gas": "7",
					"block_hash": "0x2a4f3ec7cd9572a9b28aa7fb0a2c7799b90681b67f04cd64bd5e01023b81bc3b",
					"transactions": [
						"0x02f901b883aa36a782538c8505d21dba00850ba43b74008316e360944a32aa121683ba185e2a55a52a9881135ab91e9a80b90144979986110000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000400000000000000000000000092c55b159f45648957f32c8a017ac7d62b16e1f744cd496a1dc36bcd4a73510cb07ac0a0c9989c3dbdfa6f56b5d54307286956a900000000000000000000000092c55b159f45648957f32c8a017ac7d62b16e1f7ac8b9b632aec60ff00f2e8877aeb2f3fc22842ea5f11ccffdac7db0d60d6655500000000000000000000000092c55b159f45648957f32c8a017ac7d62b16e1f76109664ef022c6a16e05d84e1f07416863fa669258886f750beb9d930e3be22f00000000000000000000000092c55b159f45648957f32c8a017ac7d62b16e1f78ddb09b000ddbb3cc50d7b7ebd90b69eb87a340b4138f9ffcc2e5e1831bfa955c080a03024de7fe25e0c43fd0bbd649a5616de42734ac627fd1e67c9424f66a99aa809a004ecfed7c69b0c629e1e7b54c0892aa44589a7ee6f19ae58949ab48b11a1b9c7",
						"0xf87182853084b2d05e1582f618947e2ff66d2044d00c1e89a19fbd6a82c86f993d908806f05b59d3b20000808401546d72a05930b936aa01b240d6a817cbd1698d0375700802e643121c9c1f107d7b2b5667a048f8a8ebc88c20505bed604232735c22457025dfc79c9befc85c8fdb561b4009",
						"0x02f9012c83aa36a70584b2d05e0084b2d05e0e8301d3a18080b8d16080604052348015600f57600080fd5b5060b38061001e6000396000f3fe6080604052348015600f57600080fd5b506004361060325760003560e01c806319ff1d21146037578063b8c9d36514604f575b600080fd5b604d600080546001600160a01b03191633179055565b005b6000546061906001600160a01b031681565b6040516001600160a01b03909116815260200160405180910390f3fea2646970667358221220a44e43bfda1fd1ed32b62279f1ddbd23b9acebe7fc5993fc1105e172833b51e464736f6c634300080a0033c001a0265de6b7714bd95cd319a076931a75ab67a09b95b199d85a0648d77e0295f56ea0736e768c5f3999f6b1d7e510f066580d572e14dc3bca5a80480b2b921ede3d31",
						"0x02f9013583aa36a78215d484b2d05e0084b2d05e0e83028ca994d71b4087cc480e897fbd335c4da947c4f750666380b8c4265e1b9000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000117e7163c42273d19ec6fd09820c2994400c6be3e77f1e40b7873c3f43f71d08e0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000002287fc001a0a325ba8f59f7651b4716034346115dd15253d3276f370543e993ee3ff5a94c83a006025fe57b9af70a0902f254f7b349c4a92a49373bf66749b10be414f0fa8a85",
						"0x02f8b583aa36a7820589849502f900849502f90e830f4240949072495afc2d59d857118ee59b4ef6cfc407d10380b84439509351000000000000000000000000e6b3b50f621d3b625714e1ea0e0f4f2abe2a84ec00000000000000000000000000000000000000000000000000038d7ea4d5c240c080a0f1a2ce3995f8302588322ab577f1a70f27ca54bb2ece13bc8bc6bc463c6d033ba025aca701fd78b9dd810a597f0ced3bdb7cbe0ea48cc58ef0f02868ab262f446b",
						"0x02f89a83aa36a715849502f900849502f90e830104e594b64a12f8cd791904d238efa789c18d6c57c906ba880214e8348c4f0000a423cf0a2200000000000000000000000000000000000000000000000000000000000002e5c080a068116eb4eb995cf1cf78f590931c9147ec8c50c245bd87cb3c0f644f87e77861a018e27c11c1871d756a9e1f5b74465d1fccc3550785bdd56f4eb96c5bcb57fc08",
						"0x02f8b383aa36a754849502f900849502f90e830f4240949072495afc2d59d857118ee59b4ef6cfc407d10380b84439509351000000000000000000000000e6b3b50f621d3b625714e1ea0e0f4f2abe2a84ec00000000000000000000000000000000000000000000000000038d7ea4d5c240c080a0023a69bcd731b9fe976e3b7306788765d18e3870c0d8261237a9e3cd1fb8f6dfa03c807878c4730f54c45a74b54e527768312d3ea8181ec50d64e0b97c9ede1675",
						"0x02f89583aa36a782362b848917370085012a05f20083030d409453844f9577c2334e541aec7df7174ece5df1fcf080a49ed933180000000000000000000000004c00cb23d75530798593593401d977bfa04bd321c001a06e712a31683b9b6ab595e3b2aaf011479c17d9261bcf60e731688e7275ed29aca06fce1af1276bf0669708330e50bbac6f9f2aa9b6459a93d8843f81c9697ca48f",
						"0x02f89583aa36a7825865848917370085012a05f20083030d409453844f9577c2334e541aec7df7174ece5df1fcf080a49ed93318000000000000000000000000df80f09c0c07b2ebdb5d5b06cb27a0ae81551788c080a06303e59e5fd5a7a9718ebd7d0d417f3989590adc1cd0738841dfb108c8bfaee4a073b04c4cb5c81d0830295f5e5fd7618816f4a70184d0754201c7a5824fa5ab57",
						"0x02f89583aa36a7823ffa848917370085012a05f20083030d409453844f9577c2334e541aec7df7174ece5df1fcf080a49ed933180000000000000000000000002699334d25bdf9a17e946ec123635713b4618309c001a00238f85ac7e5263106103480ee30078c53c20e01f5c61a55caffa0e5bf8c8ae9a0793478a1fdd97c73318fd8a39933d44b3405639dcaafc33950fe78bd5e50f814",
						"0x02f87583aa36a781ea8477359400847735940782520894b12713bfa9d1de339ca14b01f8f14f092ffe75bf872360bf8caa21c880c080a0de238048f252dde96375eafcaa074c65cbdec7999c34287114cda44694f1dc9ba02b77df486783644156cc5b633777a53fe0b939236c5dea4bce09ebc4354a3a9f",
						"0x02f87683aa36a781ec8477359400847735940782520894b12713bfa9d1de339ca14b01f8f14f092ffe75bf8801631f457a7321c880c001a082fc5dd19d7ac3c3ea2fa826064f07de6200879f07866e1ae08129b11cc9e01ba02322d73ce8b84202c2a194a9f5ceae06b8843aa4a76020b99dc741fee4555a79",
						"0x02f87683aa36a78233a88477359400847735940782520894b12713bfa9d1de339ca14b01f8f14f092ffe75bf876a6ea46c2c21c880c001a028244a0ed36f16f5c4821a4c13ce49c6a420ba256327390387884ef166a4f53fa04475663ba2168ed6c2d0521d70b85546a1bef5790e36d16c9ce6ce9a3e3e5d36",
						"0x02f87783aa36a7830154cc8477359400847735940e82520894b2a1b1d9e2c02342c0cc53eda23b118e8116aab2876a94d74f43000080c001a0b0b5bd88b1bbc8f419d487df1bb32263926d36b626fe1e68e00073e5c4422829a02afe551e216296354538a78e0919aaf0a4209082e45e6ccb557e55f0aa329e4f",
						"0x02f8b683aa36a7830154cd8477359400847735940e830186a0947169d38820dfd117c3fa1f22a697dba58d90ba0680b844a9059cbb000000000000000000000000f009ea825d9e9c14f4fc6b4dbf1e1d4a89f0d1540000000000000000000000000000000000000000000000000000000001c9c380c080a014e7f881a976dc25387866b167e849f477ccc859f1c09a7a2819d38ab6b97eafa0785baf568da58b338348d5b7b82c94425d892db12f846eb1cf101cc20bddd43a",
						"0x02f87983aa36a78307d2108459682f008501a13b86008255f0949fc7eeacd27d38a436462bb43ad97e49106820d78806f05b59d3b2000080c001a0c441d541ceac1b3bbb538f68030c3d32be90282eaa9493b3125dc40a0c6761f8a02903ae0fa905a2e2005e51798ff0eaeb51a0a0987d33f96c6cb870107554a8e2",
						"0x02f9013a83aa36a781fe8459682f008459682f08830388c6949c818e93c0884f75f48d93a9bdb2e994f8d77b86865af3107a4000b8c4e9e05c420000000000000000000000003f5d237a5ed24c2ec5712c360d3a37036f9c1efd00000000000000000000000000000000000000000000000000005af3107a40000000000000000000000000000000000000000000000000000000000000030d40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000c080a01a21ecaaa75829edb5ffc0f71233e873a0c07e4da53426a29b355b8f14436752a044193fd3af4299e43b7245bb51b22691bbb9468321c22b84718949a4ed077883",
						"0x02f8b283aa36a70b8459682f008459682f0882e815946ec9ca983b57e9ee89fc06fa4ac0dc0213fe155e80b844095ea7b30000000000000000000000005ab6249458227de13a2384bbea5e231cab2f5723ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc001a0a1667c4201aa34b24fdd20ea0858847989e6d2b8c92ec1d57363f4c1e89e5f59a051513792c8cf7548a0a926cd01082d8b0dad91b68e96d29566077812e3b0c1d1",
						"0x02f8b283aa36a70b8459682f008459682f0882e815946ec9ca983b57e9ee89fc06fa4ac0dc0213fe155e80b844095ea7b30000000000000000000000005ab6249458227de13a2384bbea5e231cab2f5723ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc080a0ddc491aac79a4084cddefa306c752fa5bd5268ecde4e5c32275b7f1f15611f08a04e57cb58b534b7fb687d55b23e4a5111dd862dedf199a144e8e604ea8089a52d",
						"0x02f87483aa36a7068459682f008459682f08825208942b5ad5c4795c026514f8317c7a215e218dccd6cf878e1bc9bf04000080c001a0f1d26afda4804c39f1ad279212be1cafccd9928361386695734edeb14191c35fa01415e819b0b7a44c91c765cf4ae92570eebdadf13c62cb3f3a84d716eb3cf58e",
						"0x02f9013a83aa36a781ff8459682f008459682f08830388c6949c818e93c0884f75f48d93a9bdb2e994f8d77b86865af3107a4000b8c4e9e05c420000000000000000000000003f5d237a5ed24c2ec5712c360d3a37036f9c1efd00000000000000000000000000000000000000000000000000005af3107a40000000000000000000000000000000000000000000000000000000000000030d40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000c001a0476f7eccf9b63f6039942c57a1dec9773daec70bddc832ed2a29a474221bb6e4a00dabf554eb60248ff235fbda67d6a01d3777bb8fc6e32f173fd51a47df2b326b",
						"0x02f87983aa36a78307d2118459682f008501a13b86008255f09445933af4934a38d3e73484e844aa539236413c958806f05b59d3b2000080c001a0832354a3d41501db619971705c56393204b99626ecb682ef16c767cfb0b9c702a010f8e28c866b6054ae0410a6cd55babdabdc46794b8ef5fe6f81a23fdd472355",
						"0x02f89483aa36a78202d0843b9aca00843b9aca0e830f4240947c15227bf20e6d2aba3ece0179e55b95a15f3f5d80a48e2e6d5d0000000000000000000000000000000000000000000000000000000000000000c001a01f59daddb9a3b70dd1cb6b117fd28c0ef2d0454c53b74737e9ff370e2dd920b4a04b1d8f40cbf903c0c95dfb91f9d7d0530a68c691b5627a56ae1a1b25bc26863e",
						"0x02f89083aa36a78253d8843b9aca00843b9aca0e82881894ff0666000000000000000000000000fff000941980a1013f6d783d7d236d51353ab46262d98da301afbb242321b263812feb431123fd28c001a085dcf32adc9542ed13a6d7ea3d3fc7184de751a7a0b59f36d2cf281e175a212ba01359185a03ae2a033e9a99f610f51fec12e248a304a66b1f62e2322f1794bdaf",
						"0x02f8f583aa36a782f331843b9aca00843b9aca0e830156c49429674fcfc8f24e96de1c0cabf6366be9e8a00fa180b8845a045f787bd24455d6628f965796b6af0751d8fed068152c1ca19394b621d020bdfdf575000000000000000000000000000000000000000000000000000000000012b24004509e89bb0a974344d0855af9c6e41f26f3198c9edb1aac21e5c11e04745ef40000000000000000000000000000000000000000000000000000000000339039c080a09f67466bc3118ab8eeb730cacb2ef649faa83d20fd6bf93196619579efbe870ca0070345b44b6c2b590c980db5d3cc6772f5e9f5533472a015d545c898fea9951d",
						"0xf9010f82acec843b9aca07830123c494041eac26aab0d7afe408c3ad3c07ea3f749e745380b8a4d45b6292000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000006f05b59d3b20000000000000000000000000000000000000000000000000000000000000000c350000000000000000000000000000000000000000000000000000000000000000100000000000000000000000051f614ee00960ec37b743236499af47d7caec3968401546d71a0650537482d4316d3b4baa04ab35b4c00ed7c4b7eaff8142ca916f06d375afe77a01d1bfae246a066a3b729a36236045002cebb637fe79f7eedb25458671d284f0a",
						"0x02f9062a83aa36a78292dd843b9aca00843b9aca0e82ac3094bac000000000000000000000000000000000000380b905b90061c68047ce7d7f581c5201508edd6fda0000000005a178da8ccc893fdb870200f00835d3d455bae29359e669d03e57b48410575e516a157bc37b23aeb83ea575546dcc9ad45636824943559b3ad25284d28a3baef6a18d68358dab4d1b1421ee2448781f9ffdfe80df3ff065f941643ef498996f0757751ab25f64bb2a147452b4cdd377a1d4aad6c1753efc0a752eed4f328ab2454fa88c1a5c37bc4614695a49a6875e5a2f5630d053d9f893891eca3d94d0bf3837232fcc8db3ff06ed4579822368dfc87fd4ac221f323e56b5968f8cf98f41de8b99d1bb179f656141833c008cb43a211fb98ba763865ecc9fcc6c11fe00b7f06d6ee899c1343648e7451d44d0201f00dda069f692bbd74b3f3b560c9d1d10bebc9cd6c2349adf5d9a404f9938c0ee2341839300f8efe7ae1518bcbaea4f1fe2dc5c4ff6ab750d409dd26734e66f1821f4cf16d9434083d300985dc744e07aa0bf98a1ce6f33b4b9f0ad747379cd76f9e430a3d05d5db857021a7c0f805d2a713b859d33444359630dec7fe67611b2cb762da78a4756bbffabd7f30be30d1945d9a6fb1ce5593a462b1baf06d8c09cae48451eb0ae840b2bbaca92dabaa04c7fe3e143500080b15704669d33c1b43e3ca2f8cd35cffafe6f49a28bcfae9a63ce08fa8dddf66c41839f00d0ac12b5b4f5e39b3396508e7ce7dc7716d3f8b73fc629feb9a0c86b3ead1bd1d9011a9c0540071d638283e9cf163efbf04a7646794c68e06387e0e36aefa411c6a6f110f16dd0e03c00229371cb6d70d9c336f274e7b28b7c7cdd724a16b133c2a4e5c7e1b63b525e83061700f0a5fbe96f34f92b9a7b8c787f55e61c394c347a5f7de874410f93dffde50f9ccfa0c125001c47099edc4e89e41e998cbd1ddb16bfb04e4b356033205fd40d5a252605d4fe4a465124f47cfcf79d7d1ccb2f742f2389a125552c03156fbd99b12924c282389fe311ae75082e03a0eddd20778be359a1b261f6468a5ac8f5ebe9887da734d86fce578729ca813a72d0a01800f5a87f0e2472c353167c167b6f923a72554dfc2fc586f06e7e8d3cee6827436b8306d70030a29ff7227b74cd1aeb912765089459c17eaec452162e71d43c16234cf83d1434b801804aa1b9a22625bc4b6a6979a1e268d2cf26df61eecc09ff80ea71beeac7fa47968106b700d048bce8da3ba8e12b913f634ec6778b7b4a7613b78fce7a4a43cadc7cb9bda740831200a4796d97ebbeeaf7e06dd65367999ca84b5ecb05d01366f2a7112677862ebc95925114297dcec1b33893b6971ca658e2e561023dabc3b0a9698d843218fee9f27fb081b2435006802c297ab0d8fa411ea99d383ea6d79ea2ffcd9de0b2b02afd20b81a1257f49a011adc0540aea0c4afdb807500f9b0d98ed5d133932c36d292b2e9ecbe8db115fd01051c34280740b6331aefc735777176c98e4e385f3f8ca863bccb25fd2bb9d9e65e9e7586fd2dd0e03e0006574f051b981ed3611d8b86df0bf3a68a6f04f10afa10dd1b4d185f8f83140db0e03c040049cf712bb5ad3b165f9e715e6a3d2bcb292712728a1e9d73df20f0cf57954282408350008ce2531fed2fd26ce013165ef269f2b6445fa799c06f42b4451bfcea85ad1a25a32832fa42b87eb8824b5de5696a78efb586ff250e5341307eb27d45831de49c5833ef3a04550030bf9789ce6c6befe6d2aaf5da7c273c93b5e407bf11d84d30432272a8e5600b34a80a80bdbbf96f1b681c82fa66ee63eb2c967e5dbbc1252c01f9a1be084667067d3c051a540340f247662a5a1400a98e3827147fbeb16f99bb58b30e75b0ec8bd2223c2928fd041a5407c05af7c5ef856a5f15641a4e54363b8ad246c8354ec874bb94d8518137098f2a010dc200b02cddf6d613c242dcb5a52eabcd3ffc2af2718f526db354f90903da76a93176daa0410d004c4351c27021a482d5bc8b44cd569295f6ad8c0289ce329aa366966115b31645465176e815c78e14628c95b4a84e57a5735faf8498ca1f1829c530226d7f9f1506ec24490f412df6ff030000ffff0549f8ed01c080a04ca3ccee98214aeb375a5be8993db90fae3f480b3fa0ffa81312a4100c904eeda064310bd5e8c3c5e29ef53cbab0755bb83b508de7075ce8d53f79984db6ce0b3a",
						"0x02f86c83aa36a780800782520894f24a01ae29dec4629dfb4170647c4ed4efc392cd870fbcedb034473880c080a05532516354e1f06d20a48e97fecf3f4216996463ba54d07e242c74ccbe73c48ea033e06d1b6d7df799c7b3f54d92efd3509c3c3cdba50d1f31b0c6a1cf95a2be52"
					],
					"withdrawals": []
				},
				"signature": "0x890edd3019111f248105b150d41e31b2a526c01ba6d8695943394796e5825c34b693efdcb05e89b0ec544d08bae6463c098e5e3855b03b1a707398cccb2c7168c86233816f6a4a026fc0d0ee660121f0951d8a76dc3c9b3dcdd7a832e0f5c44d"
			}`,
			txnCountExpected: int64(28),
			expectedBaseFee:  uint32(7),
		},
		{
			name: "no transactions",
			jsonPayload: `{
				"message": {
					"slot": "2246842",
					"parent_hash": "0x04509e89bb0a974344d0855af9c6e41f26f3198c9edb1aac21e5c11e04745ef4",
					"block_hash": "0x2a4f3ec7cd9572a9b28aa7fb0a2c7799b90681b67f04cd64bd5e01023b81bc3b",
					"builder_pubkey": "0xaa1488eae4b06a1fff840a2b6db167afc520758dc2c8af0dfb57037954df3431b747e2f900fe8805f05d635e9a29717b",
					"proposer_pubkey": "0xa66d5b1cf24a38a598a45d16818d04e1c1331f8535591e7b9d3d13e390bfb466a0180098b4656131e087b72bf10be172",
					"proposer_fee_recipient": "0xf24a01ae29dec4629dfb4170647c4ed4efc392cd",
					"gas_limit": "30000000",
					"gas_used": "1884333",
					"value": "4429853700147000"
				},
				"execution_payload": {
					"parent_hash": "0x04509e89bb0a974344d0855af9c6e41f26f3198c9edb1aac21e5c11e04745ef4",
					"fee_recipient": "0x812fc9524961d0566b3207fee1a567fef23e5e38",
					"state_root": "0x1c70df2d36ef350d3cdacb781e0153d00c1f50d77c08ff4740b2185b741483c7",
					"receipts_root": "0xafd17a85f9de5eefa2f7e38b44a2fc560ede4dbf81433d3dbbf7da6560e49bcc",
					"logs_bloom": "0x0000020000100000000002040802000001012408000024000000000000000008000a00000004040000800000148011000008100000001000080000108020000000002008c00020000080000e600010004080100440802000000000000001000000698000060018020084200205100940000002900900000100000810000000004100040000000000000040084004800001000000003100000004000000000000020800000000000100014100400802002040000000000400000008000000400400000022200000004400000000004000200000480200000000000100000020001034000000002000002000002000000080000000080800001204000000106000",
					"prev_randao": "0xa868ab4cfafc9107183622c8d955b293558cfbaa661fd1ae41403db3f3b35618",
					"block_number": "3379258",
					"gas_limit": "30000000",
					"gas_used": "1884333",
					"timestamp": "1682695704",
					"extra_data": "0xd883010b05846765746888676f312e32302e33856c696e7578",
					"base_fee_per_gas": "7",
					"block_hash": "0x2a4f3ec7cd9572a9b28aa7fb0a2c7799b90681b67f04cd64bd5e01023b81bc3b",
					"transactions": [],
					"withdrawals": []
				},
				"signature": "0x890edd3019111f248105b150d41e31b2a526c01ba6d8695943394796e5825c34b693efdcb05e89b0ec544d08bae6463c098e5e3855b03b1a707398cccb2c7168c86233816f6a4a026fc0d0ee660121f0951d8a76dc3c9b3dcdd7a832e0f5c44d"
			}`,
			txnCountExpected: int64(0),
			expectedBaseFee:  uint32(7),
		},
		{
			name:             "malformed json",
			jsonPayload:      `{}`,
			txnCountExpected: int64(0),
			expectedBaseFee:  uint32(7),
			expectedErr:      ErrBlockUnprocessable,
		},
		{
			name:             "malformed json",
			jsonPayload:      `{"message":{}, "execution_payload":{}}`,
			txnCountExpected: int64(0),
			expectedBaseFee:  uint32(7),
			expectedErr:      ErrBlockUnprocessable,
		},
	}
	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			service, err := NewBoost(Config{})
			if err != nil {
				t.Fatal(err)
			}

			var msg capella.SubmitBlockRequest
			err = json.Unmarshal([]byte(tt.jsonPayload), &msg)
			if err != nil {
				fmt.Println("error:", err)
			}
			err = service.SubmitBlock(context.TODO(), &msg)
			assert.Equal(t, err, tt.expectedErr)
			if err != nil {
				return
			}
			metadata := <-service.pushChannel

			assert.Equal(t, metadata.Transactions.Count, tt.txnCountExpected)
			assert.Equal(t, metadata.BaseFee, tt.expectedBaseFee)
		})
	}
}
